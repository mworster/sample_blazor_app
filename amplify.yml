version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo Installing .NET SDK 8
        # Update system and install necessary utilities
        - sudo yum update -y
        # Install wget and curl explicitly to avoid conflicts
        - sudo yum install -y wget
        # Install curl with the --allowerasing option to handle conflicts
        - sudo yum install -y curl --allowerasing
        # Add the Microsoft repo for CentOS/RHEL7
        - echo "[microsoft]" | sudo tee /etc/yum.repos.d/microsoft-prod.repo
        - echo "name=Microsoft Packages" | sudo tee -a /etc/yum.repos.d/microsoft-prod.repo
        - echo "baseurl=https://packages.microsoft.com/config/rhel/7/prod.repo" | sudo tee -a /etc/yum.repos.d/microsoft-prod.repo
        - echo "enabled=1" | sudo tee -a /etc/yum.repos.d/microsoft-prod.repo
        - echo "gpgcheck=1" | sudo tee -a /etc/yum.repos.d/microsoft-prod.repo
        - echo "gpgkey=https://packages.microsoft.com/keys/microsoft.asc" | sudo tee -a /etc/yum.repos.d/microsoft-prod.repo
        # Install .NET SDK 8.0 (if available)
        - sudo yum install -y dotnet-sdk-8.0
    build:
      commands:
        - echo Building the .NET project
        - dotnet publish -c Release -o ./output
  artifacts:
    baseDirectory: ./output
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*

